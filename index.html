<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador SCORM</title>
</head>
<body>
    <h1>Generador de Paquetes SCORM</h1>

    <form id="scormForm">
        <!-- Subir el video en formato MP4 -->
        <label for="video">Subir Video (MP4):</label><br>
        <input type="file" id="video" accept=".mp4"><br><br>

        <!-- Subir imágenes de las fichas en formato JPG -->
        <label for="fichas">Subir Fichas (JPG):</label><br>
        <input type="file" id="fichas" accept=".jpg" multiple><br><br>

        <!-- Subir la actividad en formato PDF -->
        <label for="pdf">Subir Actividad (PDF):</label><br>
        <input type="file" id="pdf" accept=".pdf"><br><br>

        <!-- Subir la build de Unity en formato ZIP -->
        <label for="unityZip">Subir Build de Unity (ZIP):</label><br>
        <input type="file" id="unityZip" accept=".zip"><br><br>

        <!-- Botón para generar el ZIP -->
        <button type="button" onclick="generarSCORM()">Generar Paquete SCORM</button>
    </form>

    <!-- Incluir la librería JSZip para manejar archivos ZIP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip-utils@0.1.0/dist/jszip-utils.min.js"></script>
    
    <script>
        async function generarSCORM() {
            console.log("Generando el SCORM...");

            // Crear un nuevo archivo ZIP para el paquete SCORM
            let zip = new JSZip();
            let scormFolder = zip.folder("scorm_package");

            // Manejar el archivo de video
            let videoFile = document.getElementById("video").files[0];
            if (videoFile) {
                scormFolder.folder("video").file(videoFile.name, videoFile);
                console.log("Video cargado:", videoFile.name);
            } else {
                console.log("No se cargó ningún archivo de video.");
            }

            // Manejar las fichas (imágenes)
            let fichaFiles = document.getElementById("fichas").files;
            if (fichaFiles.length > 0) {
                let fichaFolder = scormFolder.folder("ficha");
                for (let i = 0; i < fichaFiles.length; i++) {
                    fichaFolder.file(fichaFiles[i].name, fichaFiles[i]);
                    console.log("Ficha cargada:", fichaFiles[i].name);
                }
            } else {
                console.log("No se cargaron fichas.");
            }

            // Manejar el archivo de actividad (PDF)
            let pdfFile = document.getElementById("pdf").files[0];
            if (pdfFile) {
                scormFolder.folder("actividad").file(pdfFile.name, pdfFile);
                console.log("PDF cargado:", pdfFile.name);
            } else {
                console.log("No se cargó el archivo PDF.");
            }

            // Manejar el archivo ZIP de la build de Unity
            let unityZipFile = document.getElementById("unityZip").files[0];
            if (unityZipFile) {
                console.log("Cargando build de Unity desde ZIP:", unityZipFile.name);

                // Leer el archivo ZIP
                const unityZipContent = await JSZip.loadAsync(unityZipFile);
                let buildFolder = scormFolder.folder("Build");

                // Extraer los archivos del ZIP de Unity y añadirlos al ZIP SCORM
                for (const [relativePath, file] of Object.entries(unityZipContent.files)) {
                    if (!file.dir) {
                        const fileData = await file.async("blob");
                        buildFolder.file(relativePath, fileData);
                        console.log("Archivo de Unity añadido:", relativePath);
                    }
                }
            } else {
                console.log("No se cargó ningún archivo ZIP de Unity.");
            }

            // Crear imsmanifest.xml (ejemplo simple)
            let manifestXML = `<?xml version="1.0" encoding="UTF-8"?>
            <manifest identifier="curso-scorm" version="1.0"
                xmlns="http://www.imsglobal.org/xsd/imscp_v1p1">
                <metadata>
                    <schema>ADL SCORM</schema>
                    <schemaversion>1.2</schemaversion>
                </metadata>
                <organizations default="org_1">
                    <organization identifier="org_1">
                        <title>Curso SCORM</title>
                        <item identifier="item_1" identifierref="resource_1">
                            <title>Curso SCORM</title>
                        </item>
                    </organization>
                </organizations>
                <resources>
                    <resource identifier="resource_1" type="webcontent" href="index.html">
                        <file href="index.html"/>
                    </resource>
                </resources>
            </manifest>`;
            scormFolder.file("imsmanifest.xml", manifestXML);
            console.log("imsmanifest.xml creado");

            // Generar y descargar ZIP
            try {
                const blob = await zip.generateAsync({ type: "blob" });
                console.log("SCORM ZIP generado, iniciando la descarga...");

                // Crear un enlace temporal para la descarga
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "scorm_package.zip";

                // Añadir el enlace al documento para hacer clic
                document.body.appendChild(link);
                link.click();

                // Eliminar el enlace del documento
                document.body.removeChild(link);

                console.log("Descarga completada.");
            } catch (error) {
                console.error("Error al generar o descargar el ZIP:", error);
            }
        }
    </script>
</body>
</html>
