<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador SCORM</title>
</head>
<body>
    <h1>Generador de Paquetes SCORM</h1>

    <form id="scormForm">
        <!-- Subir el video en formato MP4 -->
        <label for="video">Subir Video (MP4):</label><br>
        <input type="file" id="video" accept=".mp4"><br><br>

        <!-- Subir imágenes de las fichas en formato JPG -->
        <label for="fichas">Subir Fichas (JPG):</label><br>
        <input type="file" id="fichas" accept=".jpg" multiple><br><br>

        <!-- Subir la actividad en formato PDF -->
        <label for="pdf">Subir Actividad (PDF):</label><br>
        <input type="file" id="pdf" accept=".pdf"><br><br>

        <!-- Subir archivos individuales de la Build de Unity -->
        <label for="unityLoader">Subir Unity Loader (JS):</label><br>
        <input type="file" id="unityLoader" accept=".js"><br><br>

        <label for="unityData">Subir Unity Data (Unityweb):</label><br>
        <input type="file" id="unityData" accept=".unityweb"><br><br>

        <label for="unityFramework">Subir Unity Framework (JS Unityweb):</label><br>
        <input type="file" id="unityFramework" accept=".js.unityweb"><br><br>

        <label for="unityWasm">Subir Unity WASM (Wasm Unityweb):</label><br>
        <input type="file" id="unityWasm" accept=".wasm.unityweb"><br><br>

        <!-- Botón para generar el ZIP -->
        <button type="button" onclick="generarSCORM()">Generar Paquete SCORM</button>
    </form>

    <!-- Incluir la librería JSZip para generar el ZIP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    
    <!-- Código JavaScript para generar el ZIP -->
    <script>
        async function generarSCORM() {
            console.log("Generando el SCORM...");

            // Crear un nuevo archivo ZIP
            let zip = new JSZip();
            let scormFolder = zip.folder("scorm_package");

            // Manejar el archivo de video
            let videoFile = document.getElementById("video").files[0];
            if (videoFile) {
                scormFolder.folder("video").file(videoFile.name, videoFile);
                console.log("Video cargado:", videoFile.name);
            } else {
                console.log("No se cargó ningún archivo de video.");
            }

            // Manejar las fichas (imágenes)
            let fichaFiles = document.getElementById("fichas").files;
            if (fichaFiles.length > 0) {
                let fichaFolder = scormFolder.folder("ficha");
                for (let i = 0; i < fichaFiles.length; i++) {
                    fichaFolder.file(fichaFiles[i].name, fichaFiles[i]);
                    console.log("Ficha cargada:", fichaFiles[i].name);
                }
            } else {
                console.log("No se cargaron fichas.");
            }

            // Manejar el archivo de actividad (PDF)
            let pdfFile = document.getElementById("pdf").files[0];
            if (pdfFile) {
                scormFolder.folder("actividad").file(pdfFile.name, pdfFile);
                console.log("PDF cargado:", pdfFile.name);
            } else {
                console.log("No se cargó el archivo PDF.");
            }

            // Archivos de la Build de Unity
            let buildFolder = scormFolder.folder("Build");

            // Unity Loader
            let unityLoader = document.getElementById("unityLoader").files[0];
            if (unityLoader) {
                buildFolder.file(unityLoader.name, unityLoader);
                console.log("Unity Loader cargado:", unityLoader.name);
            }

            // Unity Data
            let unityData = document.getElementById("unityData").files[0];
            if (unityData) {
                buildFolder.file(unityData.name, unityData);
                console.log("Unity Data cargado:", unityData.name);
            }

            // Unity Framework
            let unityFramework = document.getElementById("unityFramework").files[0];
            if (unityFramework) {
                buildFolder.file(unityFramework.name, unityFramework);
                console.log("Unity Framework cargado:", unityFramework.name);
            }

            // Unity Wasm
            let unityWasm = document.getElementById("unityWasm").files[0];
            if (unityWasm) {
                buildFolder.file(unityWasm.name, unityWasm);
                console.log("Unity WASM cargado:", unityWasm.name);
            }

            // Crear imsmanifest.xml (ejemplo simple)
            let manifestXML = `<?xml version="1.0" encoding="UTF-8"?>
            <manifest identifier="curso-scorm" version="1.0"
                xmlns="http://www.imsglobal.org/xsd/imscp_v1p1">
                <metadata>
                    <schema>ADL SCORM</schema>
                    <schemaversion>1.2</schemaversion>
                </metadata>
                <organizations default="org_1">
                    <organization identifier="org_1">
                        <title>Curso SCORM</title>
                        <item identifier="item_1" identifierref="resource_1">
                            <title>Curso SCORM</title>
                        </item>
                    </organization>
                </organizations>
                <resources>
                    <resource identifier="resource_1" type="webcontent" href="index.html">
                        <file href="index.html"/>
                    </resource>
                </resources>
            </manifest>`;
            scormFolder.file("imsmanifest.xml", manifestXML);
            console.log("imsmanifest.xml creado");

            // Generar y descargar ZIP
            try {
                const blob = await zip.generateAsync({ type: "blob" });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "scorm_package.zip";
                link.click();
                console.log("SCORM ZIP generado y listo para descargar.");
            } catch (error) {
                console.error("Error al generar el ZIP:", error);
            }
        }
    </script>
</body>
</html>
